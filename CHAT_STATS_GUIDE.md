# 水群榜功能使用指南

## 📊 功能介绍

**水群榜**是一个统计群成员发言数量并生成排行榜的功能，增加群聊互动趣味性。

### 核心功能

1. **自动统计** - 实时记录每个群成员的发言次数
2. **每日推送** - 每天23:00自动发送排行榜到群聊
3. **手动查询** - 使用命令查看实时排名

## 🎯 使用方法

### 命令查询

在群聊中发送以下命令：

```
/水群榜
/聊天榜  （别名）
/发言榜  （别名）
```

**效果**:
```
🏆 水群榜 🏆
统计时间：从 2025-11-30 23:00:00 至今

👑 水王 张三 (156条) 💦
🥈 亚军 李四 (89条)
🥉 季军 王五 (67条)
4️⃣ 赵六 (45条)
5️⃣ 孙七 (32条)
6️⃣ 周八 (28条)
7️⃣ 吴九 (21条)
8️⃣ 郑十 (18条)
9️⃣ 钱十一 (15条)
🔟 陈十二 (12条)

━━━━━━━━━━━━━━━━
📊 群总消息：524条
👥 活跃人数：28人
```

### 自动推送

每天 **23:00** 自动推送当日排行榜到所有活跃群。

**推送内容**:
```
🏆 今日水群榜 🏆
统计时间：2025-11-30 00:00 ~ 23:00

[排行榜内容...]
```

## ⚙️ 配置说明

在 `.env` 文件中配置：

```bash
# 启用/禁用水群榜
ENABLE_CHAT_STATS=true

# 推送时间（小时，24小时制）
STATS_PUSH_HOUR=23

# 显示前N名
STATS_TOP_COUNT=10

# 数据文件路径
STATS_FILE=data/chat_stats.json
```

### 配置选项说明

| 配置项 | 说明 | 默认值 | 示例 |
|--------|------|--------|------|
| `ENABLE_CHAT_STATS` | 是否启用功能 | true | true/false |
| `STATS_PUSH_HOUR` | 每日推送时间 | 23 | 0-23（小时） |
| `STATS_TOP_COUNT` | 显示排名数量 | 10 | 5/10/15/20 |
| `STATS_FILE` | 数据存储文件 | data/chat_stats.json | 任意路径 |

## 📋 排行榜说明

### 排名称号

- 👑 **第1名** - 水王（带💦标记）
- 🥈 **第2名** - 亚军
- 🥉 **第3名** - 季军
- 4️⃣-🔟 **第4-10名** - 数字标记

### 统计信息

- **群总消息** - 当前统计周期内的总消息数
- **活跃人数** - 发过言的成员数量

### 统计周期

- **每日推送** - 统计当天 00:00 ~ 23:00 的数据
- **手动查询** - 统计从上次23:00推送到现在的数据
- **跨天处理** - 每天00:00自动重置统计

## 🎮 使用场景

### 场景1: 日常互动
```
成员A: "大家今天聊的真嗨"
成员B: "/水群榜"
Bot: [显示实时排名]
成员C: "卧槽我才第5，加油冲榜！"
```

### 场景2: 每日总结
```
[23:00 自动推送]
Bot: 🏆 今日水群榜 🏆
     [排行榜...]
     
成员们: "哈哈我今天话最多"
       "明天继续冲榜"
```

### 场景3: 活跃度监控
```
群主: "/水群榜"
Bot: [显示排名]
     活跃人数：28人
     
群主: "嗯，群活跃度不错"
```

## 📊 数据说明

### 数据存储

数据保存在 `data/chat_stats.json`:

```json
{
  "date": "2025-11-30",
  "groups": {
    "123456789": {
      "users": {
        "user_001": {
          "nickname": "张三",
          "count": 156,
          "last_msg_time": "2025-11-30 22:30:00"
        }
      },
      "last_push_time": "2025-11-30 23:00:00"
    }
  }
}
```

### 数据特点

- ✅ **自动保存** - 每10条消息保存一次
- ✅ **自动重置** - 每天00:00重置统计
- ✅ **持久化** - 重启不丢失数据
- ✅ **多群支持** - 不同群独立统计

## 🔧 部署说明

### 文件清单

```
src/plugins/chat_stats/
├── __init__.py         - 插件主文件
└── stats_manager.py    - 统计管理器

data/
└── chat_stats.json     - 统计数据（自动创建）
```

### 部署步骤

1. **上传文件**
   ```bash
   scp -r src/plugins/chat_stats user@vps:/path/to/qqbot/src/plugins/
   ```

2. **配置环境变量**
   编辑 `.env` 文件添加配置

3. **重启服务**
   ```bash
   docker-compose restart
   ```

4. **验证功能**
   - 在群里发几条消息
   - 发送 `/水群榜` 查看
   - 检查数据文件是否创建

## ⚠️ 注意事项

### 性能考虑

- 消息记录不影响正常聊天
- 每10条消息才保存一次数据
- 排行榜生成速度很快

### 隐私说明

- 只统计消息数量
- 不保存消息内容
- 昵称会实时更新

### 多群使用

- 不同群独立统计
- 互不影响
- 都会在23:00推送

## 💡 优化建议

### 调整推送时间

如果群活跃高峰不在23点：

```bash
# 改为晚上22点推送
STATS_PUSH_HOUR=22
```

### 调整显示数量

如果群人数多：

```bash
# 显示前20名
STATS_TOP_COUNT=20
```

### 禁用某个群

目前会对所有活跃群推送，如需禁用某些群，需要在代码中添加群黑名单功能（可选扩展）。

## 🎯 常见问题

### Q1: 什么时候开始统计？
A: 功能部署后立即开始统计，从当前时刻到次日00:00。

### Q2: 数据会保留多久？
A: 每天00:00重置，只保留当天数据。

### Q3: Bot掉线期间的消息会统计吗？
A: 不会，只统计Bot在线期间的消息。

### Q4: 可以查看历史排行榜吗？
A: 当前版本不支持，只能查看当前统计周期的数据。

### Q5: 推送会打扰群友吗？
A: 每天只推送一次（23:00），且内容简洁，不会造成骚扰。

---

**功能状态**: ✅ 已实现  
**版本**: v1.0  
**更新日期**: 2025-11-30
